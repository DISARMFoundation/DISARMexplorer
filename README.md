# DISARM Explorer code
Code for an online viewer of the DISARM frameworks and datasets. 

Written in Python, Flask, D3. 

## How to make this run

### Running locally

Getting set up to run the code

* install postgresql locally https://www.postgresql.org/
* Use the DISARM repo to generate a database for you https://github.com/DISARMFoundation/DISARM file CODE/generate_DISARM_pages.ipynb will do this for you (run it using jupyter - install that using anaconda https://www.anaconda.com/). NB You might need to go to the terminal window and type "create disarmsite" first. 
* Open a terminal window.  git clone this repo. cd into it 
* Create a virtual environment: from the top folder of this repo, type "virtualenv venv" into the terminal window (see https://uoa-eresearch.github.io/eresearch-cookbook/recipe/2014/11/26/python-virtual-env/ for details).

Running the code

* . venv/bin/activate; 
* export FLASK_APP=disarmsite; export FLASK_ENV=development; export DATABASE_URL2="postgresql:///disarmsite"
* flask run
* go to http://127.0.0.1:5000/


###Running on Heroku 

Getting set up to run on Heroku

* Create a heroku account. Create an app. 
* Click on the app, then the resources tab. Add the Postgres add-on.  
* go to https://dashboard.heroku.com/apps/<your heroku app name>/settings
* click "reveal config vars"
* Edit DATABASE_URL: take a copy of it. It will start with "postgres://"
* Create DATABASE_URL2: copy DATABASE_URL into it, but start it with start with "postgresql://" instead
* heroku git:remote -a your-app-name (see https://devcenter.heroku.com/articles/git)

Running on Heroku - updating Heroku code and database

* pg_dump -Fc -h localhost -U \<yourdatabaseusername\> disarmsite > disarmsite.dump  
* heroku pg:reset -a \<your heroku app name\>   
* heroku pg:push disarmsite DATABASE_URL -a \<your heroku app name\> 
* git add .; git commit -m "heroku stuff"; git push heroku main


## Database notes

* Database objects are generated by the DISARM repo, Jupyter notebook file [generate_DISARM_sql.ipynb](https://github.com/DISARMFoundation/DISARM/blob/main/CODE/generate_DISARM_sql.ipynb).  Still normalising the DISARM repo tables - adding tables as they're needed. Also, the MISP galaxy for this is at [https://github.com/MISP/misp-galaxy/blob/main/clusters/misinfosec-amitt-misinformation-pattern.json](https://github.com/MISP/misp-galaxy/blob/main/clusters/misinfosec-amitt-misinformation-pattern.json) and will need updating also. 
* Next: adding in ability to create the new disinformation-specific MISP objects in https://github.com/MISP/misp-objects/tree/main/objects
